document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("lightbox");if(!e)return;const a=e.querySelector(".lb-image"),O=e.querySelector(".lb-caption"),M=e.querySelector(".lb-close"),k=e.querySelector(".lb-prev"),F=e.querySelector(".lb-next");let d=[],n=0,o=!1,t=1,i=0,s=0;const w=1,_=3,y=.15;let l=null,v=0,j=0,C=1,c=!1,f=0,m=0,h=0,p=0;const A=50;function u(){a.style.transform=`translate(${i}px, ${s}px) scale(${t})`}function E(e,t){return Math.hypot(t.clientX-e.clientX,t.clientY-e.clientY)}function b(){const t=a.getBoundingClientRect(),n=e.getBoundingClientRect(),o=Math.max(0,(t.width-n.width)/2),r=Math.max(0,(t.height-n.height)/2);i=Math.min(o,Math.max(-o,i)),s=Math.min(r,Math.max(-r,s))}function x(){t=1,i=0,s=0,a.style.transform=""}function S(t,n){o=!0,e.classList.remove("is-loaded");const s=new Image;s.onload=()=>{a.src=t,O.textContent=n,x(),e.classList.add("is-loaded"),o=!1},s.onerror=()=>{O.textContent="Impossible de charger lâ€™image",e.classList.add("is-loaded"),o=!1},s.src=t}function r(t){if(o)return;n=(t+d.length)%d.length;const s=d[n],i=s.dataset.src,a=s.dataset.caption||s.dataset.label||"";if(!i)return;e.hidden=!1,document.body.style.overflow="hidden",S(i,a)}function g(){e.hidden=!0,a.src="",e.classList.remove("is-loaded"),document.body.style.overflow="",x()}document.addEventListener("click",e=>{const t=e.target.closest("[data-lightbox]");if(!t||!t.dataset.src)return;e.preventDefault();const s=t.dataset.lightbox;d=[...document.querySelectorAll(`[data-lightbox="${s}"][data-src]`)],n=d.indexOf(t),r(n)}),M?.addEventListener("click",g),k?.addEventListener("click",()=>r(n-1)),F?.addEventListener("click",()=>r(n+1)),e.addEventListener("click",t=>{t.target===e&&g()}),document.addEventListener("keydown",t=>{if(e.hidden)return;t.key==="Escape"&&g(),t.key==="ArrowLeft"&&r(n-1),t.key==="ArrowRight"&&r(n+1)}),e.addEventListener("wheel",n=>{if(e.hidden||!n.ctrlKey)return;n.preventDefault(),n.deltaY<0?t=Math.min(_,t+y):t=Math.max(w,t-y),u()},{passive:!1}),e.addEventListener("mousedown",n=>{if(e.hidden||t<=1||o)return;if(n.button!==0)return;n.preventDefault(),c=!0,f=n.clientX,m=n.clientY,h=i,p=s,e.style.cursor="grabbing"}),window.addEventListener("mousemove",t=>{if(!c)return;if(!(t.buttons&1)){c=!1,e.style.cursor="";return}i=h+(t.clientX-f),s=p+(t.clientY-m),b(),u()}),window.addEventListener("mouseup",()=>{if(!c)return;c=!1,e.style.cursor=""}),e.addEventListener("touchstart",n=>{if(e.hidden||o)return;if(n.touches.length===2){l="pinch",j=E(n.touches[0],n.touches[1]),C=t;return}if(n.touches.length===1){const e=n.touches[0];t>1?(l="pan",c=!0,f=e.clientX,m=e.clientY,h=i,p=s):(l="swipe",v=e.clientX)}},{passive:!0}),e.addEventListener("touchmove",n=>{if(e.hidden||o)return;if(l==="pinch"&&n.touches.length===2){n.preventDefault();const e=E(n.touches[0],n.touches[1]),s=e/j;t=Math.min(_,Math.max(w,C*s)),u();return}if(l==="pan"&&t>1&&n.touches.length===1){n.preventDefault();const e=n.touches[0];i=h+(e.clientX-f),s=p+(e.clientY-m),b(),u()}},{passive:!1}),e.addEventListener("touchend",s=>{if(e.hidden||o)return;if(l==="swipe"&&t===1){if(!s.changedTouches||s.changedTouches.length!==1)return;const e=s.changedTouches[0].clientX-v;(e<0?-e:e)>=A&&r(e>0?n-1:n+1)}l=null,c=!1}),a.addEventListener("dragstart",e=>e.preventDefault()),a.addEventListener("mousedown",e=>e.preventDefault())})